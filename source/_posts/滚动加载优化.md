---
title: 滚动加载优化
date: 2018-05-16 15:50:13
tags: ['功能', '优化']
---
## 优化原因
接上一篇[滚动加载](/2018/05/14/移动端滚动加载)留的问题。
1. 当列表过长，大量DOM存在于页面之中，当滚动发生时频繁重排造成页面卡顿。
2. 如果列表中每一条包含图片等外部资源，一是加载耗时，二是展示图片需要更多内存，列表过长时卡顿现象更加明显。

## 优化分析
1. 既然是因为DOM过多造成的影响，那么解决的目的就明晰了，减少DOM数量
2. 对于图片，除了减少页面中的DOM结构以外，还需要针对图片的加载做优化，常见的就是图片懒加载。
### 图片懒加载
先来看一个效果，图片比较大，网络不是很好，所以效果比较明显。。。,同时首屏的图片也没有加载。

![图片懒加载](图片懒加载.gif)

在图片还未加载时，先用本地图片占位，页面滚动时，判断图片是否到了`可见区域`，若是，则加载图片同时标记图片已被加载，算了，还是先不说这些，一步步来，首先为什么需要懒加载，懒加载真的有用吗？
让我们来看看两张图：

使用图片懒加载：
![使用懒加载网络请求](使用懒加载.png) 

不使用图片懒加载：
![不使用懒加载网络请求](不使用懒加载.png)

若不使用懒加载，那么同一时间有多少新增图片就发送多少新增请求，而浏览器对于同一个域有并发限制(一般4-8个)，同时服务器为稳定性也对客户端并发数做了限制，如果图片是单独域名下存储还好，但如果是主域名下的静态图片呢？（虽然很少这么干）结果就是在css中使用到的背景图片加载会阻塞其他资源的下载。图片放在单独的域名下不存在阻塞静态资源的问题，但是不能保证用户完整浏览页面的情况下就加载出大量图片，是对带宽的过度占用。
总结起来主要就是节省网络带宽，同时避免阻塞时间过长。

了解懒加载的目的后就是怎么落实代码了。当然，还是要先分析一波。

#### 原理分析
懒加载，直白点就是图片出现在我们定义的可视区域后再加载，在可视区域外的话就是用占位图展示